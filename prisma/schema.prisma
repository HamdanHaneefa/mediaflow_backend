generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model assets {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String
  description          String?
  type                 String
  category             String?
  status               String    @default("Available")
  location             String?
  purchase_date        DateTime? @db.Date
  purchase_price       Decimal?  @db.Decimal(12, 2)
  current_value        Decimal?  @db.Decimal(12, 2)
  serial_number        String?
  manufacturer         String?
  model                String?
  condition            String?
  maintenance_schedule Json?
  last_maintenance     DateTime? @db.Date
  next_maintenance     DateTime? @db.Date
  assigned_to          String?   @db.Uuid
  assigned_project     String?   @db.Uuid
  files                Json?
  notes                String?
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
  updated_at           DateTime  @default(now()) @db.Timestamptz(6)
  projects             projects? @relation(fields: [assigned_project], references: [id])

  @@index([assigned_project])
  @@index([status])
  @@index([type])
}

model client_activities {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_user_id String       @db.Uuid
  action         String
  entity_type    String?
  entity_id      String?      @db.Uuid
  metadata       Json?
  ip_address     String?
  user_agent     String?
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  client_users   client_users @relation(fields: [client_user_id], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([client_user_id])
  @@index([created_at])
  @@index([entity_type])
}

model client_documents {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_user_id String       @db.Uuid
  project_id     String?      @db.Uuid
  filename       String
  original_name  String
  file_path      String
  file_size      Int
  mime_type      String
  uploaded_by    String
  uploader_id    String       @db.Uuid
  uploader_name  String
  description    String?
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  client_users   client_users @relation(fields: [client_user_id], references: [id], onDelete: Cascade)
  projects       projects?    @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([created_at])
  @@index([project_id])
  @@index([uploaded_by])
}

model client_messages {
  id                    String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_user_id        String            @db.Uuid
  project_id            String?           @db.Uuid
  sender_type           String
  sender_id             String            @db.Uuid
  sender_name           String
  subject               String?
  message               String
  attachments           Json?
  is_read               Boolean           @default(false)
  read_at               DateTime?         @db.Timestamptz(6)
  parent_id             String?           @db.Uuid
  created_at            DateTime          @default(now()) @db.Timestamptz(6)
  client_users          client_users      @relation(fields: [client_user_id], references: [id], onDelete: Cascade)
  client_messages       client_messages?  @relation("client_messagesToclient_messages", fields: [parent_id], references: [id])
  other_client_messages client_messages[] @relation("client_messagesToclient_messages")
  projects              projects?         @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([created_at])
  @@index([is_read])
  @@index([parent_id])
  @@index([project_id])
  @@index([sender_type])
}

model client_notifications {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_user_id String       @db.Uuid
  type           String
  title          String
  message        String
  link           String?
  metadata       Json?
  is_read        Boolean      @default(false)
  read_at        DateTime?    @db.Timestamptz(6)
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  client_users   client_users @relation(fields: [client_user_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([created_at])
  @@index([is_read])
  @@index([type])
}

model client_sessions {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_user_id String       @db.Uuid
  token          String       @unique
  ip_address     String?
  user_agent     String?
  expires_at     DateTime     @db.Timestamptz(6)
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  client_users   client_users @relation(fields: [client_user_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([expires_at])
  @@index([token])
}

model client_users {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contact_id           String                 @unique @db.Uuid
  email                String                 @unique
  password_hash        String
  is_verified          Boolean                @default(false)
  verification_token   String?                @unique
  reset_token          String?                @unique
  reset_token_expires  DateTime?              @db.Timestamptz(6)
  last_login           DateTime?              @db.Timestamptz(6)
  is_active            Boolean                @default(true)
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  updated_at           DateTime               @default(now()) @db.Timestamptz(6)
  client_activities    client_activities[]
  client_documents     client_documents[]
  client_messages      client_messages[]
  client_notifications client_notifications[]
  client_sessions      client_sessions[]
  contacts             contacts               @relation(fields: [contact_id], references: [id], onDelete: Cascade)

  @@index([contact_id])
  @@index([email])
  @@index([reset_token])
  @@index([verification_token])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model contact_notes {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contact_id   String        @db.Uuid
  note         String
  created_by   String?       @db.Uuid
  created_at   DateTime      @default(now()) @db.Timestamptz(6)
  contacts     contacts      @relation(fields: [contact_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_contact_note_contact")
  team_members team_members? @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "fk_contact_note_creator")

  @@index([contact_id], map: "idx_contact_notes_contact")
  @@index([created_at(sort: Desc)], map: "idx_contact_notes_created")
}

model contacts {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  email         String          @unique
  phone         String?
  company       String?
  role          String          @default("Client")
  status        String          @default("Active")
  notes         String?
  tags          String[]        @default([])
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  updated_at    DateTime        @default(now()) @db.Timestamptz(6)
  first_name    String?         @db.VarChar(255)
  last_name     String?         @db.VarChar(255)
  position      String?         @db.VarChar(255)
  type          String?         @db.VarChar(50)
  avatar_url    String?
  address       String?
  city          String?         @db.VarChar(100)
  country       String?         @db.VarChar(100)
  last_contact  DateTime?       @db.Timestamptz(6)
  client_users  client_users?
  contact_notes contact_notes[]
  income        income[]
  projects      projects[]
  proposals     proposals[]
  tasks         tasks[]
  converted_from_leads leads[]    @relation("leads_converted_to_contact")

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([city], map: "idx_contacts_city")
  @@index([country], map: "idx_contacts_country")
  @@index([first_name], map: "idx_contacts_first_name")
  @@index([last_name], map: "idx_contacts_last_name")
  @@index([type], map: "idx_contacts_type")
}

model events {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String
  description String?
  type        String    @default("Meeting")
  start_time  DateTime  @db.Timestamptz(6)
  end_time    DateTime  @db.Timestamptz(6)
  location    String?
  project_id  String?   @db.Uuid
  attendees   String[]  @default([]) @db.Uuid
  color       String?
  is_all_day  Boolean   @default(false)
  recurrence  Json?
  reminder    Json?
  status      String    @default("Scheduled")
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime  @default(now()) @db.Timestamptz(6)
  projects    projects? @relation(fields: [project_id], references: [id])

  @@index([end_time])
  @@index([project_id])
  @@index([start_time])
  @@index([status])
}

model expenses {
  id                                               String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                                       String?                  @db.Uuid
  title                                            String
  description                                      String?
  amount                                           Decimal                  @db.Decimal(12, 2)
  category                                         String
  expense_date                                     DateTime                 @db.Date
  receipt_url                                      String?
  receipt_filename                                 String?
  vendor                                           String?
  status                                           String                   @default("Draft")
  submitted_by                                     String?                  @db.Uuid
  approved_by                                      String?                  @db.Uuid
  approved_at                                      DateTime?                @db.Timestamptz(6)
  rejection_reason                                 String?
  created_at                                       DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime                 @default(now()) @db.Timestamptz(6)
  team_members_expenses_approved_byToteam_members  team_members?            @relation("expenses_approved_byToteam_members", fields: [approved_by], references: [id])
  projects                                         projects?                @relation(fields: [project_id], references: [id])
  team_members_expenses_submitted_byToteam_members team_members?            @relation("expenses_submitted_byToteam_members", fields: [submitted_by], references: [id])
  financial_transactions                           financial_transactions[]

  @@index([category])
  @@index([expense_date])
  @@index([project_id])
  @@index([status])
  @@index([submitted_by])
}

model financial_transactions {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id       String?   @db.Uuid
  type             String
  income_id        String?   @db.Uuid
  expense_id       String?   @db.Uuid
  amount           Decimal   @db.Decimal(12, 2)
  description      String
  transaction_date DateTime  @db.Date
  status           String    @default("Pending")
  reference_number String?
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  updated_at       DateTime  @default(now()) @db.Timestamptz(6)
  expenses         expenses? @relation(fields: [expense_id], references: [id])
  income           income?   @relation(fields: [income_id], references: [id])
  projects         projects? @relation(fields: [project_id], references: [id])

  @@index([project_id])
  @@index([transaction_date])
  @@index([type])
}

model income {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id             String?                  @db.Uuid
  title                  String
  description            String?
  amount                 Decimal                  @db.Decimal(12, 2)
  income_type            String
  expected_date          DateTime?                @db.Date
  received_date          DateTime?                @db.Date
  status                 String                   @default("Expected")
  invoice_number         String?
  client_id              String?                  @db.Uuid
  created_at             DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at             DateTime                 @default(now()) @db.Timestamptz(6)
  financial_transactions financial_transactions[]
  contacts               contacts?                @relation(fields: [client_id], references: [id])
  projects               projects?                @relation(fields: [project_id], references: [id])

  @@index([client_id])
  @@index([expected_date])
  @@index([project_id])
  @@index([status])
}

model project_assignments {
  id                                                            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                                                    String        @db.Uuid
  team_member_id                                                String        @db.Uuid
  role_in_project                                               String
  assigned_at                                                   DateTime      @default(now()) @db.Timestamptz(6)
  assigned_by                                                   String?       @db.Uuid
  is_lead                                                       Boolean       @default(false)
  responsibilities                                              String[]      @default([])
  hourly_rate_override                                          Decimal?      @db.Decimal(8, 2)
  team_members_project_assignments_assigned_byToteam_members    team_members? @relation("project_assignments_assigned_byToteam_members", fields: [assigned_by], references: [id])
  projects                                                      projects      @relation(fields: [project_id], references: [id], onDelete: Cascade)
  team_members_project_assignments_team_member_idToteam_members team_members  @relation("project_assignments_team_member_idToteam_members", fields: [team_member_id], references: [id], onDelete: Cascade)

  @@index([project_id])
  @@index([team_member_id])
}

model project_comments {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id     String   @db.Uuid
  client_user_id String   @db.Uuid
  comment        String
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  projects       projects @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([created_at])
  @@index([project_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model project_files {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id        String        @db.Uuid
  filename          String        @db.VarChar(255)
  original_filename String        @db.VarChar(255)
  file_url          String
  file_type         String?       @db.VarChar(100)
  file_size         BigInt?
  mime_type         String?       @db.VarChar(100)
  uploaded_by       String?       @db.Uuid
  description       String?
  category          String?       @default("General") @db.VarChar(50)
  is_public         Boolean?      @default(false)
  created_at        DateTime      @default(now()) @db.Timestamptz(6)
  projects          projects      @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_project_file_project")
  team_members      team_members? @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction, map: "fk_project_file_uploader")

  @@index([created_at(sort: Desc)], map: "idx_project_files_created")
  @@index([project_id], map: "idx_project_files_project")
  @@index([file_type], map: "idx_project_files_type")
  @@index([uploaded_by], map: "idx_project_files_uploader")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model project_milestones {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id     String    @db.Uuid
  title          String    @db.VarChar(255)
  description    String?
  due_date       DateTime  @db.Date
  completed_date DateTime? @db.Date
  status         String    @default("Pending") @db.VarChar(50)
  order_index    Int?      @default(0)
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  updated_at     DateTime  @default(now()) @db.Timestamptz(6)
  projects       projects  @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_milestone_project")

  @@index([due_date], map: "idx_milestones_due_date")
  @@index([project_id], map: "idx_milestones_project")
  @@index([status], map: "idx_milestones_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model projects {
  id                       String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title                    String
  description              String?
  type                     String                     @default("Commercial")
  status                   String                     @default("Active")
  phase                    String                     @default("Pre-production")
  client_id                String?                    @db.Uuid
  budget                   Decimal?                   @db.Decimal(12, 2)
  start_date               DateTime?                  @db.Date
  end_date                 DateTime?                  @db.Date
  team_members             String[]                   @default([]) @db.Uuid
  created_at               DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at               DateTime                   @default(now()) @db.Timestamptz(6)
  name                     String                     @db.VarChar(255)
  priority                 String?                    @default("Medium") @db.VarChar(20)
  spent                    Decimal?                   @default(0) @db.Decimal(12, 2)
  progress                 Int?                       @default(0)
  assets                   assets[]
  client_documents         client_documents[]
  client_messages          client_messages[]
  events                   events[]
  expenses                 expenses[]
  financial_transactions   financial_transactions[]
  income                   income[]
  project_assignments      project_assignments[]
  project_comments         project_comments[]
  project_files            project_files[]
  project_milestones       project_milestones[]
  contacts                 contacts?                  @relation(fields: [client_id], references: [id])
  proposals                proposals[]
  tasks                    tasks[]
  team_project_assignments team_project_assignments[]

  @@index([priority], map: "idx_projects_priority")
  @@index([progress], map: "idx_projects_progress")
  @@index([client_id])
  @@index([phase])
  @@index([status])
}

model proposal_responses {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  proposal_id    String    @db.Uuid
  client_user_id String    @db.Uuid
  status         String
  comments       String?
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  proposals      proposals @relation(fields: [proposal_id], references: [id], onDelete: Cascade)

  @@index([client_user_id])
  @@index([created_at])
  @@index([proposal_id])
  @@index([status])
}

model proposals {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String
  client_id          String               @db.Uuid
  project_id         String?              @db.Uuid
  lead_id            String?              @db.Uuid
  status             String               @default("Draft")
  total_amount       Decimal              @db.Decimal(12, 2)
  valid_until        DateTime             @db.Date
  terms              String?
  notes              String?
  items              Json                 @default("[]")
  pdf_url            String?
  sent_at            DateTime?            @db.Timestamptz(6)
  viewed_at          DateTime?            @db.Timestamptz(6)
  accepted_at        DateTime?            @db.Timestamptz(6)
  rejected_at        DateTime?            @db.Timestamptz(6)
  rejection_reason   String?
  created_at         DateTime             @default(now()) @db.Timestamptz(6)
  updated_at         DateTime             @default(now()) @db.Timestamptz(6)
  proposal_responses proposal_responses[]
  contacts           contacts             @relation(fields: [client_id], references: [id], onDelete: Cascade)
  projects           projects?            @relation(fields: [project_id], references: [id])
  lead               leads?               @relation(fields: [lead_id], references: [id])

  @@index([client_id])
  @@index([project_id])
  @@index([lead_id])
  @@index([status])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model task_attachments {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id           String        @db.Uuid
  filename          String        @db.VarChar(255)
  original_filename String        @db.VarChar(255)
  file_url          String
  file_type         String?       @db.VarChar(100)
  file_size         BigInt?
  mime_type         String?       @db.VarChar(100)
  uploaded_by       String?       @db.Uuid
  created_at        DateTime      @default(now()) @db.Timestamptz(6)
  tasks             tasks         @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_task_attachment_task")
  team_members      team_members? @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction, map: "fk_task_attachment_uploader")

  @@index([task_id], map: "idx_task_attachments_task")
  @@index([uploaded_by], map: "idx_task_attachments_uploader")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model task_comments {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  task_id      String       @db.Uuid
  user_id      String       @db.Uuid
  comment      String
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  updated_at   DateTime     @default(now()) @db.Timestamptz(6)
  tasks        tasks        @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_task_comment_task")
  team_members team_members @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_task_comment_user")

  @@index([created_at(sort: Desc)], map: "idx_task_comments_created")
  @@index([task_id], map: "idx_task_comments_task")
  @@index([user_id], map: "idx_task_comments_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tasks {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title            String
  description      String?
  status           String             @default("To Do")
  project_id       String?            @db.Uuid
  assigned_to      String?            @db.Uuid
  due_date         DateTime?          @db.Date
  priority         String             @default("Medium")
  type             String             @default("Administrative")
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime           @default(now()) @db.Timestamptz(6)
  completed_at     DateTime?          @db.Timestamptz(6)
  estimated_hours  Decimal?           @db.Decimal(5, 2)
  actual_hours     Decimal?           @db.Decimal(5, 2)
  progress         Int?               @default(0)
  task_attachments task_attachments[]
  task_comments    task_comments[]
  contacts         contacts?          @relation(fields: [assigned_to], references: [id])
  projects         projects?          @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([completed_at], map: "idx_tasks_completed_at")
  @@index([progress], map: "idx_tasks_progress")
  @@index([assigned_to])
  @@index([project_id])
  @@index([status])
}

model team_invitations {
  id               String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email            String
  role             String        @default("Assistant")
  permissions      Json          @default("{}")
  invited_by       String?       @db.Uuid
  invitation_token String        @unique
  expires_at       DateTime      @db.Timestamptz(6)
  status           String        @default("Pending")
  message          String?
  created_at       DateTime      @default(now()) @db.Timestamptz(6)
  updated_at       DateTime      @default(now()) @db.Timestamptz(6)
  team_members     team_members? @relation(fields: [invited_by], references: [id])

  @@index([email])
  @@index([invitation_token])
  @@index([status])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model team_members {
  id                                                                   String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                                              String?                    @db.Uuid
  first_name                                                           String?
  last_name                                                            String?
  email                                                                String                     @unique
  password                                                             String?
  phone                                                                String?
  avatar_url                                                           String?
  role                                                                 String                     @default("member")
  position                                                             String?
  department                                                           String?
  status                                                               String                     @default("active")
  permissions                                                          Json                       @default("{}")
  hourly_rate                                                          Decimal?                   @db.Decimal(8, 2)
  emergency_contact                                                    Json?
  skills                                                               String[]                   @default([])
  bio                                                                  String?
  hire_date                                                            DateTime?                  @default(now()) @db.Date
  assigned_projects                                                    String[]                   @default([]) @db.Uuid
  performance_metrics                                                  Json?
  invitation_status                                                    String?                    @default("Accepted")
  invited_at                                                           DateTime?                  @db.Timestamptz(6)
  invited_by                                                           String?                    @db.Uuid
  last_active                                                          DateTime?                  @default(now()) @db.Timestamptz(6)
  team_id                                                              String?                    @db.Uuid
  created_at                                                           DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                                                           DateTime                   @default(now()) @db.Timestamptz(6)
  contact_notes                                                        contact_notes[]
  expenses_expenses_approved_byToteam_members                          expenses[]                 @relation("expenses_approved_byToteam_members")
  expenses_expenses_submitted_byToteam_members                         expenses[]                 @relation("expenses_submitted_byToteam_members")
  project_assignments_project_assignments_assigned_byToteam_members    project_assignments[]      @relation("project_assignments_assigned_byToteam_members")
  project_assignments_project_assignments_team_member_idToteam_members project_assignments[]      @relation("project_assignments_team_member_idToteam_members")
  project_files                                                        project_files[]
  task_attachments                                                     task_attachments[]
  task_comments                                                        task_comments[]
  team_invitations                                                     team_invitations[]
  team_members                                                         team_members?              @relation("team_membersToteam_members", fields: [invited_by], references: [id])
  other_team_members                                                   team_members[]             @relation("team_membersToteam_members")
  teams_team_members_team_idToteams                                    teams?                     @relation("team_members_team_idToteams", fields: [team_id], references: [id])
  team_project_assignments                                             team_project_assignments[]
  teams_teams_created_byToteam_members                                 teams[]                    @relation("teams_created_byToteam_members")
  teams_teams_manager_idToteam_members                                 teams[]                    @relation("teams_manager_idToteam_members")
  created_leads                                                        leads[]                    @relation("leads_created_by")

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([team_id])
}

model team_project_assignments {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  team_id      String        @db.Uuid
  project_id   String        @db.Uuid
  assigned_at  DateTime      @default(now()) @db.Timestamptz(6)
  assigned_by  String?       @db.Uuid
  team_members team_members? @relation(fields: [assigned_by], references: [id])
  projects     projects      @relation(fields: [project_id], references: [id], onDelete: Cascade)
  teams        teams         @relation(fields: [team_id], references: [id], onDelete: Cascade)

  @@unique([team_id, project_id])
  @@index([project_id])
  @@index([team_id])
}

model teams {
  id                                          String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                                        String
  description                                 String?
  manager_id                                  String?                    @db.Uuid
  member_ids                                  String[]                   @default([]) @db.Uuid
  project_ids                                 String[]                   @default([]) @db.Uuid
  created_by                                  String?                    @db.Uuid
  created_at                                  DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                                  DateTime                   @default(now()) @db.Timestamptz(6)
  team_members_team_members_team_idToteams    team_members[]             @relation("team_members_team_idToteams")
  team_project_assignments                    team_project_assignments[]
  team_members_teams_created_byToteam_members team_members?              @relation("teams_created_byToteam_members", fields: [created_by], references: [id])
  team_members_teams_manager_idToteam_members team_members?              @relation("teams_manager_idToteam_members", fields: [manager_id], references: [id])

  @@index([manager_id])
  @@index([name])
}

model leads {
  id                    String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                  String
  email                 String
  phone                 String?
  company               String?
  source                String?
  status                String       @default("New")
  priority              String?
  score                 Int          @default(0)
  budget                Decimal?     @db.Decimal(12, 2)
  project_type          String?
  timeline              String?
  notes                 String?
  tags                  String[]     @default([])
  contact_date          DateTime?    @db.Timestamptz(6)
  follow_up_date        DateTime?    @db.Timestamptz(6)
  estimated_close_date  DateTime?    @db.Date
  created_by            String       @db.Uuid
  converted_contact_id  String?      @db.Uuid
  converted_at          DateTime?    @db.Timestamptz(6)
  created_at            DateTime     @default(now()) @db.Timestamptz(6)
  updated_at            DateTime     @default(now()) @db.Timestamptz(6)
  creator               team_members @relation("leads_created_by", fields: [created_by], references: [id], onDelete: Cascade)
  converted_contact     contacts?    @relation("leads_converted_to_contact", fields: [converted_contact_id], references: [id])
  proposals             proposals[]

  @@index([created_by])
  @@index([status])
  @@index([email])
  @@index([converted_contact_id])
}
